const supabase = require('../db/supabase');
const PLAYERS_DATABASE = require('../data/players');

async function seedDatabase() {
    console.log(`Starting migration of ${PLAYERS_DATABASE.length} players...`);

    // 1. Create Table Check (Manual step usually, but we can log the schema)
    console.log('\nIMPORTANT: Ensure you have run this SQL in your Supabase SQL Editor:');
    console.log(`
    create table if not exists players (
        id bigint generated by default as identity primary key,
        name text not null,
        club text,
        era text,
        league text,
        position text,
        age int,
        market_value numeric,
        tier text,
        play_style text,
        created_at timestamp with time zone default timezone('utc'::text, now()) not null
    );
    `);

    // 2. Insert Data
    const { error: deleteError } = await supabase.from('players').delete().neq('id', 0); // Clear table (optional)

    // Chunking to avoid payload limits
    const chunkSize = 50;
    for (let i = 0; i < PLAYERS_DATABASE.length; i += chunkSize) {
        const chunk = PLAYERS_DATABASE.slice(i, i + chunkSize).map(p => ({
            name: p.name,
            club: p.club,
            era: p.era,
            league: p.league,
            position: p.position,
            age: p.age,
            market_value: p.marketValue, // Note camelCase mapping
            tier: p.tier,
            play_style: p.playStyle
        }));

        const { error } = await supabase.from('players').insert(chunk);

        if (error) {
            console.error('Error inserting chunk:', error);
        } else {
            console.log(`Inserted players ${i + 1} to ${Math.min(i + chunkSize, PLAYERS_DATABASE.length)}`);
        }
    }

    console.log('Migration complete!');
}

seedDatabase();
